<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sakurabaema Premium</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let hue = 0;

        function resize() {
            canvas.width = window.innerWidth * window.devicePixelRatio;
            canvas.height = window.innerHeight * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }

        class Particle {
            constructor(x, y, h, speedMult = 1) {
                this.x = x;
                this.y = y;
                const angle = Math.random() * Math.PI * 2;
                const force = Math.random() * 5 * speedMult;
                this.vx = Math.cos(angle) * force;
                this.vy = Math.sin(angle) * force;
                this.size = Math.random() * 4 + 2;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.005;
                this.h = h;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.05; // 模拟微弱重力
                this.life -= this.decay;
                this.size *= 0.97;
            }
            draw() {
                ctx.fillStyle = `hsla(${this.h}, 80%, 60%, ${this.life})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                // 增加外发光
                ctx.shadowBlur = 10;
                ctx.shadowColor = `hsla(${this.h}, 80%, 60%, ${this.life * 0.5})`;
            }
        }

        function createBlast(x, y, count, h) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, h, 2));
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            for (let i = 0; i < e.touches.length; i++) {
                const t = e.touches[i];
                // 划动产生粒子
                for(let j=0; j<2; j++) particles.push(new Particle(t.clientX, t.clientY, hue));
                // 随机变色
                hue = (hue + 0.5) % 360;
            }
        }

        let pressTimer;
        window.addEventListener('touchstart', (e) => {
            const t = e.touches[0];
            pressTimer = setInterval(() => {
                createBlast(t.clientX, t.clientY, 5, hue);
            }, 50);
        });

        window.addEventListener('touchend', () => clearInterval(pressTimer));
        window.addEventListener('touchmove', handleTouch);
        window.addEventListener('resize', resize);

        function animate() {
            // 这里的半透明填充制造了“拖尾”效果
            ctx.fillStyle = 'rgba(5, 5, 5, 0.15)';
            ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
            ctx.shadowBlur = 0;

            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animate);
        }

        resize();
        animate();
    </script>
</body>
</html>
